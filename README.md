# versiongen #

[![GoDoc](https://godoc.org/github.com/andmarios/go-versiongen?status.svg)](http://godoc.org/github.com/andmarios/go-versiongen)

Versiongen is an opinionated approach to a common problem: how to add to your
go software's build information about its version / repository commit.

It is opinionated because:

- It works via go generate
- Expects you to use git
- Expects you to have tags (at least one) in your repository

## Usage

The use is pretty simple. You add a go program to run via
go generate:

```go
package main

import (
	"log"

	"github.com/andmarios/go-versiongen"
)

func main() {
	err := versiongen.Create()
	if err != nil {
		log.Fatalln(err)
	}
}
```

This will add a `version.go` file in the directory you ran `go generate`
that will include 2 constants: _vgVersion_ and _vgHash_. It will look like:

```go
package main
// auto generated by github.com/andmarios/go-versiongen

const (
        vgVersion   = "0.1-dirty"
        vgHash      = "c2362208e1f70fba02b2240a9b743a5aef76a900"
)
```

_vgVersion_ is the version of your program as provided by `git describe --tags`.
If you have uncommited changes, the `DirtyString` will be appended to the
version.  It is by default `-dirty` but can be changed to your liking.

_vgHash_ is the SHA1 of the current HEAD.

What you will do with them, is up to you. Have a look into the _example_
directory to better understand how it works.

Other knobs include `IgnoreFiles` which is an array of filenames to ignore
uncommited changes on. Usually you want to add here other files that
are generated by `go generate` (and for some reason you decided to commit them
to your repository). You can also create the version file to a custom path
instead of `version.go`.

## Criticism

The solution is obviously far from perfect. In the past I used custom `go
generate` code, git pre-commit hooks and other methods to auto-create build
version information.  None was perfect and without a standard I lost more time
than needed. Build version on runtime is very important in order to identify
which version of your application is deployed.

_Versiongen_ is quick to setup with acceptable output for most small go
programs.

---


License is Apache 2.0.
